name: Test rclone Connection

on:
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë§Œ

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Install rclone
      run: |
        curl https://rclone.org/install.sh | sudo bash
    
    - name: Configure rclone
      run: |
        mkdir -p ~/.config/rclone
        
        # RCLONE_CONFIG ì‹œí¬ë¦¿ í™•ì¸
        if [ -z "$RCLONE_CONFIG" ]; then
          echo "âŒ Error: RCLONE_CONFIG secret is empty or not set"
          echo "âš ï¸  GitHub Secretsì— RCLONE_CONFIGë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”."
          exit 1
        fi
        
        echo "âœ… RCLONE_CONFIG ì‹œí¬ë¦¿ í™•ì¸ë¨ (ê¸¸ì´: ${#RCLONE_CONFIG} ë¬¸ì)"
        
        # ì„¤ì • íŒŒì¼ ì‘ì„±
        echo "$RCLONE_CONFIG" > ~/.config/rclone/rclone.conf
        
        # ì„¤ì • íŒŒì¼ í™•ì¸
        if [ ! -f ~/.config/rclone/rclone.conf ]; then
          echo "âŒ Error: rclone.conf file was not created"
          exit 1
        fi
        
        if [ ! -s ~/.config/rclone/rclone.conf ]; then
          echo "âŒ Error: rclone.conf file is empty"
          exit 1
        fi
        
        echo "âœ… rclone.conf íŒŒì¼ ìƒì„± ì™„ë£Œ"
        echo "ğŸ“„ íŒŒì¼ í¬ê¸°: $(wc -c < ~/.config/rclone/rclone.conf) bytes"
        echo ""
        echo "ğŸ“‹ ì„¤ì • íŒŒì¼ ë‚´ìš© (drive_id/drive_type í™•ì¸):"
        grep -E "drive_id|drive_type" ~/.config/rclone/rclone.conf || echo "âš ï¸  drive_id/drive_type ì—†ìŒ!"
        
      env:
        RCLONE_CONFIG: ${{ secrets.RCLONE_CONFIG }}
    
    - name: Test rclone connection
      run: |
        echo "ğŸ”§ [1ë‹¨ê³„] rclone ë²„ì „ í™•ì¸"
        rclone version
        
        echo ""
        echo "ğŸ”§ [2ë‹¨ê³„] ì›ê²© ëª©ë¡ í™•ì¸"
        rclone listremotes || { echo "âŒ listremotes ì‹¤íŒ¨"; exit 1; }
        
        echo ""
        echo "ğŸ”§ [3ë‹¨ê³„] onedrive ì„¤ì • í™•ì¸"
        rclone config show onedrive | head -20 || { echo "âŒ config show ì‹¤íŒ¨"; exit 1; }
        
        echo ""
        echo "ğŸ”§ [4ë‹¨ê³„] OneDrive ë£¨íŠ¸ í´ë” ëª©ë¡ í™•ì¸"
        rclone lsd onedrive: || { echo "âŒ lsd ì‹¤íŒ¨"; exit 1; }
        
        echo ""
        echo "ğŸ”§ [5ë‹¨ê³„] 'office work' í´ë” í™•ì¸"
        rclone lsd "onedrive:office work" || { echo "âŒ 'office work' í´ë” ì—†ìŒ ë˜ëŠ” ì ‘ê·¼ ì‹¤íŒ¨"; exit 1; }
        
        echo ""
        echo "ğŸ”§ [6ë‹¨ê³„] 'ë¶€ë™ì‚° ì‹¤ê±°ë˜ ë°ì´í„°' í´ë” í™•ì¸"
        rclone lsd "onedrive:office work/ë¶€ë™ì‚° ì‹¤ê±°ë˜ ë°ì´í„°" || { echo "âŒ 'ë¶€ë™ì‚° ì‹¤ê±°ë˜ ë°ì´í„°' í´ë” ì—†ìŒ ë˜ëŠ” ì ‘ê·¼ ì‹¤íŒ¨"; exit 1; }
        
        echo ""
        echo "ğŸ”§ [7ë‹¨ê³„] í´ë” ë‚´ íŒŒì¼ ëª©ë¡ í™•ì¸ (ìµœëŒ€ 20ê°œ)"
        rclone lsf "onedrive:office work/ë¶€ë™ì‚° ì‹¤ê±°ë˜ ë°ì´í„°" | head -20 || { echo "âŒ íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨"; exit 1; }
        
        echo ""
        echo "âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ ì™„ë£Œ! rcloneì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤!"
